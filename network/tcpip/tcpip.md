## 

B/S架构, 实际是C/S架构的泛化、特例, 将客户端泛化，中心还是 Server

应用程序通常是进程，下三层是在内核实现


UDP:
    TFTP
    DNS

TCP:
    FTP



## 会话层

拿QQ来举例，QQ软件有一个端口号，但是不同人之间的会话是隔离的

一个端口有很多会话; 一个大对数有很多芯



## IP 是不可靠的

tcp 相当于卖家，ip 相当于物流，顾客收到货物后才会付款，但是 IP(物流) 不一定能送到




## ping -s 最大值

1500 MTU   数据链路层的一个帧, 所以包含各种头部+数据

一个数据链路层帧最大值是 1500Bytes

ip header 是 20Bytes

icmp header 是 8Bytes

1500 - 20 - 8 = 1472 Bytes

所以 ping -s 最大值是 1472 


最基本的协议号、端口号

1. 以太网协议号(在数据链路层中表明)
    IPv4    : 0x0800
    IPv6    : 
    ARP     : 0x0806
    PPPOE   : 0x8863 0x8864

1. IP协议号(在网络层中表示)
    ICMP: 1
    TCP : 6
    UDP : 17
    GRE : 47
    ESP : 50
    AH  : 51

1. 端口号(在传输层表示)
    FTP     : 20(Data) 21(control)
    SSH     : 22
    SFTP    : 22
    Telnet  : 23
    SMTP    : 25
    POP3    : 110
     IMAP   : 143
    TACACS+ : 49
    HTTP    : 80
    HTTPS   : 443
    IKE     : 500
    Radius  : 1645 1646 1812 1813

    well-known ports: from 0 through 1023



                    +---+    +---+
                    |TCP|    |UDP|
                    +---+    +---+
    +----+  +----+    |        |
    |ICMP|  |IGMP|    |        |
    +----+  +----+    |        |
     |        |       |        |
      \       |       |       /
       \      |       |      /
        \     |       |     /
         \    |       |    /
          \   |       |   /
           \  |       |  /
         +----------------+   +---+   +----+
         |      IP        |   |ARP|   |RARP|
         +----------------+   +---+   +----+
                        |       |       / 
                         \      |      /
                          \     |     /
                           \    |    /
                            \   |   /
                           +---------+ 
                           | 以太网  |
                           +---------+ 


### 路由跟踪 

linux
    ping -R <目标>

Cisco 路由器
    ping 
    根据提示进行设置



## telnet route-server.ip.att.net

用户名: rviews
密  码: rviews

查看全球 IP 路由信息






## 虚电路交换

1. 再发送第一个数据包之前要进行连接的建立，一般等待时间位 RTT

1. 连接请求包含完整的目的地址，但每个数据包只携带很小的 VC 标识，一次每个包的开销较小

1. 如果链接上的链路或交换机故障，必须建立一个新的连接。

1. 连接建立位预留资源提供了支持

VC标识: Virtual Circuit




### 虚电路的实现

VC转变表的维护

    1. 每当建立了一条新 VC 时，在表中添加一项
    1. 每当终止一条 VC 时, 在表中删除相应条目

    +-------------------+-------------------+
    |        入境       |        处境       |
    +-------------------+-------------------+
    |  境线路|虚电路号  |  出境线路|虚电路号|
    +-------------------+-------------------+
    |     A  |  0       |     B    |   0    |
    +-------------------+-------------------+
    |     A  |  1       |     C    |   0    |
    +-------------------+-------------------+



## ATM 虚电路网络

从电话网络进化而来
人类的习惯
    严格的时序，可靠性需求
    需要有保证的服务
哑端系统
    电话
    复杂性在网络内部




802.3   以太网
802.4   令牌总线
802.5   令牌环
X.25    是一个使用电话或者ISDN设备作为网络硬件设备来架构广域网的ITU-T网络协议


传输网关在传输层连接字节流
应用网关允许第4层以上的互联


中继器
    1. 放大器
    1. 信号再生器
        会剔除噪声

    缺点:
        引入延迟
        不具备检错/纠错能力
        不能适用于不通速度的以太网

网桥
    有两个口，网段指的就是一边，而不是三层的网段概念


路由器
    一种用于连接两个运行相同/不通协议的IS(中间系统)

网关
    用于连接两个异构的相互独立的网络, 可以支持不通协议之间的转换。

    协议网关
        用于使用不通协议的网络之间进行协议转换

        链路层网关
            解决两种不通帧格式的网络之间的互联
        网络层网关
            完成不通网络层协议之间的转换，如 IPV4 和 IPV6 的转换
        
    应用网关
        用于不通格式之间翻译数据的系统, 如 EMAIL 网关
        POP
        X.400
        SMTP
        MHS
    安全网关(防火墙)

防火墙



路由选择
    非自适应算法(静态路由)
    自适应算法(动态路由)
        缺点
            路由决策复杂
            依赖于状态信息
            不能太快和太慢
        优点
            可提高网络性能
            有助于拥塞控制

路由算法的特性
    正确性
    简单性(减少开销)
    健壮性(网络中局部出现问题时，能避免跳坑)
    稳定性(不能来回翻摆)
    最优性(优先级的优化)
    公平性
    有效性(投入产出,路由等的维护与开销)

### 路由技术元素

性能标准
    1. 跳计数
    1. 成本
        与链路有关
        与数据率有关(数据率越高，成本越低)
        与当前排队延迟有关
    1. 延迟
    1. 吞吐量

网络信息源
    大多数路由决策要求根据网络拓扑，交通负载，链路成本等做出决定
    1. 无
    1. 局部
    1. 邻接节点
    1. 全部节点

信息更新时间
    1. 连续
    1. 定期
    1. 负载变化
    1. 拓扑变化

决策时间(路由表什么时候生成)
    1. 包(数据报)
        数据报到达时
        为每个包单独作路由决策
    1. 会晤(虚电路)
        虚电路建立时

决策地点
    1. 每个节点(分布)
        每个节点都负责位到达的包选择一条输出链路
    1. 中心节点(集中)
        由某些指定节点(如网络控制中心)负责决策
    1. 原始节点(源端)
        由源站点而非网络做出

自适应策略
    1. 故障
    1. 拥塞



### 静态路由算法

中心路由目录

    1 2 3 4 5 6
  1 -
  2   -
  3     -
  4       -
  5         -
  6           -


### 最短路径选择

最小跳数
最短距离
信道带宽
传输延迟
平均通信量

### 距离向量算法

#### DV算法的特点

1. 分布式的
    每个节点接收来自与其直接邻接节点的信息执行路由计算，将计算结果回传给直接邻接的节点

1. 迭代的
    计算过程循环进行，知道相邻节点没有可交换的信息位置

1. 异步的
    并不要求所有节点相互锁步操作
