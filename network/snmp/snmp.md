
应用层协议(TCP/IP)

C/S 架构

三种角色
    1. 客户端
    1. 服务端
        1. 代理 agent
        1. 代理 proxy



SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。

一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。

但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。





https://www.cnblogs.com/whsa/p/4238746.html


## SNMP的工作方式：

管理员需要向设备获取数据，所以SNMP提供了【读】操作；

管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；

设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。


SNMP简单说，包括了被管的设备，代理和网管系统三个部分。被管的设备指的就是我们要获取信息的设备，这个任务里我需要获取它的磁盘空间。但是被管理设备只是产生这些数据，真正将数据报告回来的工作是由代理完成的。代理说白了就是一个运行在被管设备上的程序。网络编程的角度讲它就是一个小的socket服务程序，监听着好像是161端口。通过在被管设备上，需要启动snmp服务。比如在linux上，就需要执行service snmpd start来启动snmp服务，也就是把代理跑起来。实际过程中，代理包含在各种网络设备上，包括交换机，路由器甚至打印机，手机，调制解调器上。网管系统就是我们要从被管设备获取数据并进行分析处理的这个程序。可以想像它运行在本地。只要我将一个合格的请求发往正在运行的代理处，代理从请求中，理解请求的内容，并从被管设备上用它自己的方式搜集到所需的信息，并发送回来，这样一个网管的简单过程就完成了。



### 端口

SNMP采用UDP协议在管理端和agent之间传输信息。 

SNMP采用UDP 161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。

SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。


### Snmp版本

SNMP目前共有v1，v2，v3这三个版本： 

SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 

SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。

SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。



### Snmp有关的基本概念

1. 代理和管理站的模型

　　Snmp分2种角色：SNMP管理站（manager，我们的本机127.0.0.1）和SNMP代理（agent， 我们要操作的机器，比如 192.168.1.144）。管理站指的是运行了可以执行网络
    管理任务软件的服务器，通常被称作为网络管理工作站（NMS）,NMS负责采样网络中agent的信息，并接受agent的trap。代理是实际网络设备中用来实现SNMP功能的部分。代
    理在UDP的161端口接收NMS的读写请求消息，管理站在UDP的162端口接收代理的事件通告消息。所以，一旦获取设备的访问权限（community，默认为public），就可以访问
    设备信息、改写和配置设备参数。由于采用UDP协议，不需要在代理和管理站之间保持连接。


    +-----+                                                         +-------+
    |     |<---------- Trap sent to NMS-----------------------------|       |
    |     |                                                         |       |
    | NMS |---------- Query sent to agent ------------------------->| Agent |
    |     |                                                         |       |
    |     |<--- Response to query sent from the agent to the NMS----|       |
    +-----+                                                         +-------+


1. SNMP的操作命令

　　SNMP协议之所以易于使用，这是因为它对外提供了三种用于控制MIB对象的基本操作命令。它们是：Get、Set 和 Trap。

    Get：管理站读取代理者处对象的值。它是SNMP协议中使用率最高的一个命令，因为该命令是从网络设备中获得管理信息的基本方式。

    Set：管理站设置代理者处对象的值。它是一个特权命令，因为可以通过它来改动设备的配置或控制设备的运转状态。它可以设置设
         备的名称，关掉一个端口或清除一个地址解析表中的项等。

    Trap： 代理者主动向管理站通报重要事件。它的功能就是在网络管理系统没有明确要求的前提下，由管理代理通知网络管理系统有
        一些特别的情况或问题 发生了。如果发生意外情况，客户会向服务器的162端口发送一个消息，告知服务器指定的变量值发生了
        变化。通常由服务器请求而获得的数据由服务器的161 端口接收。Trap 消息可以用来通知管理站线路的故障、连接的终端和恢复、
        认证失败等消息。管理站可相应的作出处理。 


1. SNMP 消息构成

    SNMP协议定义了数据包的格式，及网络管理员和管理代理之间的信息交换，它还控制着管理代理的MIB数据对象。因此，可用于处理管理代理定义的各种任务。     
    一条SNMP消息由"版本号"、"SNMP共同体名"和"协议数据单元(PDU)"构成，数据包的长度不是固定的。

    +---------+----------------+------+
    | version | community name | DATA |
    +---------+----------------+------+
　　

    版本识别符(version identifier)：用于说明现在使用的是哪个版本的SNMP协议，确保SNMP代理使用相同的协议，每个SNMP代理都直接抛弃与自己协议版本不同的数据报。

    团体名(Community Name)：团体（community）是基本的安全机制，用于实现SNMP网络管理员访问SNMP管理代理时的身份验证。类似于密码，默认值为 public。
    团体名（Community name）是管理代理的口令，管理员被允许访问数据对象的前提就是网络管理员知道网络代理的口令。如果把配置管理代理成可以执行Trap命令，
    当网络管理 员用一个错误的分区名查询管理代理时，系统就发送一个autenticationFailure trap报文。

    协议数据单元（PDU）：PDU (协议数据单元)是SNMP消息中的数据区， 即Snmp通信时报文数据的载体。PDU指明了SNMP的消息类型及其相关参数


1. MIB(管理信息库)

    管理信息(MIB)库可以理解成为agent维护的管理对象数据库，MIB中定义的大部分管理对象的状态和统计信息都可以被NMS访问。MIB是一个按照层次结构组织的树状结构，
    每个被管对象对应树形结构的一个叶子节点，称为一个object，拥有唯一的数字标识符

　　MIB数据对象以一种树状分层结构进行组织，这个树状结构中的每个分枝都有一个专用的名字和一个数字形式的标识符。结构树的分枝实际表示的是数据对象的逻 辑分组。而树叶，
    有时候也叫节点（node），代表了各个数据对象。在结构树中使用子树表示增加的中间分枝和增加的树叶。      使用这个树状分层结构，MIB浏览器能够以一种方便而且
    简洁的方式访问整个MIB数据库。MIB浏览器是这样一种工具，它可以遍历整棵MIB结构树，通常 以图形显示的形式来表示各个分枝和树叶对象。可以通过其数字标识符来查
    找MIB中的数据对象，这个数字标识符号从结构树的顶部（或根部）开始，直到各个叶 子节点（即数据对象）为止。这种访问方式和文件系统的组织方式一致。两者的主要
    区别在于文件系统中的路径名可以以绝对也可以以相对方式表示，而MIB数据 对象只能以绝对方式表示，不能使用相对方式。      每一个节点都有一个对象标识符（OID）
    来唯一的标识，每个节点用数字和字符两种方式显示，其中对象标识符OID是由句点隔开的一组整数，也就是从根节点 通向它的路径。一个带标号节点可以拥有包含其它带
    标号节点为它的子树，如果没有子树它就是叶子节点，它包含一个值并被称为对象。比如网络设备名的oid 是.1.3.6.1.2.1.1.5.0，其值为设备名称的字符串。      

    网络资源被抽象为对象进行管理。但SNMP中的对象是表示被管资源某一方面的数据变量。对象被标准化为跨系统的类，对象的集合被组织为管理信息库 （MIB）。MIB作为
    设在代理者处的管理站访问点的集合，管理站通过读取MIB中对象的值来进行网络监控。管理站可以在代理者处产生动作，也可以通过修改变量值改变代理者处的配置。

1. OID(Object Identifier)

    每个管理对象都有自己的OID(Object Identifier)，管理对象通过树状结构进行组织，OID由树上的一系列整数组成，整数之间用点( .  )分隔开，树的叶子节点才是真正能够被管理的对象。







SNMPAgent：每个网络设备上都有个Agent，有些已经内建Agent，有些则要外接SNMPAgent，它主负责接收来自NMS的命令，以回报其网络设备的状况，当网络设备发生状况时，会透过Agent发出Trap告知NMS。


Proxy强调服务器的安全性、隐秘性、面向的调用方为非用户，分解Server的压力；

Agent强调客户端（面向用户级）、本地化、统一收集信息，处理转换消息，发送至Server并更新本地状态。


SNMP Traps are alert messages sent from a remote SNMP-enabled device to a central collector, the "SNMP manager"

Trap messages are the main form of communication between an SNMP Agent and an SNMP Manager. 

They are used to inform an SNMP manager when an important event happens at the Agent level. 

**A benefit of using Traps for reporting alarms is that they trigger instantaniously, rather than waiting for a status request from the manager.**


## 管理信息库MIB(被管理设备信息数据库)

1. 任何一个被管理的资源都表示成一个对象，称为被管理的对象。
1. MIB是被管理对象的集合。
1. 它定义了被管理对象的一系列属性：对象的名称、对象的访问权限和对象的数据类型等。每个SNMP设备（Agent）都有自己的MIB。
1. MIB也可以看作是NMS（网络管理系统，网络管理系统既可以指一台专门用来进行网络管理的服务器，也可以指某个网络设备中执行管理功能的一个应用程序）和Agent之间的沟通桥梁。



## 

                switch
                 /|\
                / | \
               /  |  \
              /   |   \
             /    |    \
           OS    net   disk         每个节点一个编号，叫做OID(Object Identifier)
          /|\
         / | \
        



community name
