## 自治系统（Autonomous System）

用通俗的语言来形容，就是一个互联网的独立王国，这一个个独立王国互联起来，就组成了互联网（Internet）。

每个王国有自己独立的国号，以区别于别的王国，这个国号用自治系统号ASN（Autonomous System Number），ASN

由两个字节组成，理论上取值范围为 1-65535，末尾的1024个ASN是私有自治号，用于王国内部的下属郡国使用，不

能外泄（类似私有IP，如果不小心外泄，别人也会忽略）。每一个互联网用户都置身于AS内，比如中国电信的AS号为 

4809，那么中国电信的用户就置身于4809的独立王国，如果用户访问的服务器也是在这个AS内，那双向的流量都在王国里来回溜达。

## 但如果服务器IP位于中国移动AS内，如何跨运营商访问呢？

运营商之间会使用BGP（Border Gateway Protocol) 路由协议来交换各自的IP路由表，AS号就是BGP协议用来辨识邻国的一个身份证，

同时在交换的路由表信息里，会附上各自的AS号。既然中国电信通过BGP学习到中国移动的路由信息，就会把用户的访问请求转发给

中国移动的边界路由器，既然IP包进入中国移动的地界，接下来就任由中国移动的设备来处理了，假设顺利到达服务器，回程检查客

户IP，发现是电信的IP，就会转发到电信的边界路由器，并到达用户。

## 运营商属于合作、竞争关系，关系微妙

如果运营商之间不互联，那运营商将会变成一个个孤岛，所以需要互联链路（桥梁）将孤岛连接起来，连接起来就会产生竞争关系。

蛋糕就那么大，谁多吃一口，别人就会少吃一口，所以跨运营商的流量服务不会太好，带宽不足，容易丢包，延迟大。所以对于财

大气粗的公司的服务器会提供多个运营商的入口IP，依据客户端IP归属哪个运营商（AS），智能DNS Server 会返回和客户端位于相

同AS的服务器IP，这样客户端访问服务器就会低延迟、低丢包、快速响应。不光运营商可以拥有AS号，一些大型企业如 Google , 

Amonzon, Apple , EBay 都拥有自己的AS号，一个AS号通常足够使用，但运营商通常会有多个AS号，用于不同的独立的网络。



https://www.ipip.net/ip.html
