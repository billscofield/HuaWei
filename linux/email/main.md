
links:

    http://blog.sina.com.cn/s/blog_af19951a0102yz1j.html

    https://blog.csdn.net/yatum_2014/article/details/79734428



MUA  |  outlook、thunderbird、Mac Mail、mutt
MTA  |  sendmail、postfix、exim4(Debian 默认)
MDA  |  procmail、dropmail
MRA  |  dovecot  


## MUA

MUA（Mail User Agent）：“邮件用户代理”, MUA是用在客户端的软件，客户端的计算机无法直接收发邮件，需要通过MUA传递信件，通过各个操作系统
提供的MUA才能够使用邮件系统。MUA主要的功能就是接收邮件主机的电子邮件，并提供用户浏览与编写邮件的功能。

 

## MTA

MTA（Mail Transfer Agent）：MTA是用在邮件主机上的软件，主要的邮件服务器。MTA就是“邮件传送代理”，负责用户寄信与收信，MTA的功能： 

    1. 接收外部主机寄来的信件：既然是邮件主机，接收信件自然是主要功能，只要这个信件里有MTA内部账号，这封信就会被MTA收下来； 

    1. 帮用户发（寄出）信：利用这台MTA主机把信传送出去！不过要注意，MTA会将信件送给目的地的MTA而不是目的地的MUA

    注意：用户使用的是MUA，而信件仅会送达MTA主机上，收、发信件时，都需要通过MTA帮忙处理，所以，用户在使用邮件编辑器“MUA”将数据编辑完毕之后，
    按下送出，并且成功送到MTA之后，接下来的事情就是MTA的工作了，跟用户的Client端计算机没有关系。

    用户收自己的信：用户可以将放置在邮件主机的信件收到自己的个人计算机上。 


## MDA

MDA（Mail Delivery Agent）：“邮件投递代理”将MTA接收的信件依照信件的流向（送到哪里）将该信件放置到本机账户下的邮件文件中（收件箱），或
者再经由MTA将信件送到下个MTA。如果信件的流向是到本机，这个邮件代理的功能就不只是将由MTA传来的邮件放置到每个用户的收件箱，它还可以具有
邮件过滤（filtering），可以通过MDA邮件分析功能，将信件丢弃。让邮件主机在别人给你发信时自动回复一封，让寄件人知道你在忙碌中。

Mailbox：“收件箱”，主机上一个目录下某个人专用来接收信件的文件！举个例子，系统管理员root在默认情况下会有个信箱，默认的文件就是
/var/spool/mail/root文件（每个账号都会有一个自己的信箱），然后，当MTA收到root的信时，就会将该信件存到/var/spool/mail/root文件中，
用户可以通过程序将这个文件里的信件数据读取出来。 


## MRA

MRA（Mail Receive Agent）负责实现IMAP与POP3协议，与MUA进行交互；相当于让你的邮件账户支持离线邮件收取，而不是电脑打开才能收取邮件。

## 过程











Step 1 ： 用户利用MUA寄信到MTA。通常我们使用MUA（例如Outlook express）写信时，要写明几个项：

发信人与发信网站：必须有这个信息。发信网站就是下面Step 2接收信件的那个MTA； 
收信人与收信网站：以er的形式给出，其中，account就是该e-mail.server里的账号。    
“本地客户端使用的电脑”，利用MUA功能（如Outlook express）写好信之后，按下MUA的“发送”按钮，MUA就会依据你所定义的主机地址将信发送到MTA上。 

Step 2 ：MTA收到信件，分两种情况

 

将信件放置在收信者的信箱中。 如果在Step 1收到的信件中，那个e-mail.server就是MTA自己，此时MTA会将该信件交由MDA处理，将信件放置在收信者的信箱中。
MTA将信再转送出去。如果由Step 1发来的信件的收件人并不是MTA的内部账号，那么该信将被再次转送出去！Step 1及Step 2的动作，我们也称为Relay（邮件转发）功能。
 
Step 3： 远程MTA收到本地MTA发出的邮件。远程MTA会收到我们这台MTA的信件，并将该信件交给它的MDA处理（Step4），此时，信件会存放在远程MTA上，等待用户登录读取或下载。 

Step4：  远程用户使用的计算机直接连接到它的MTA，向MTA请求查看自己的收件箱是否有信件，而MTA通过MDA去检查，如果有信件，就会将它传送给用户的MUA。

同时，根据MUA的不同设置，MTA会选择将该信件从收件箱清除或继续保留！若继续保留，那么下次用户再次接收信件时，保留的信件会再次被下载，因此，通常用户MUA都是默认删除MTA的收件箱中的内容。




---

大致流程如下：

　　一、 用户利用MUA寄信到MTA。配置MUA时要配上smtp服务器域名,然后发送邮件。比如使用网易账户发送邮件就要在配置smtp.163.com,这样邮件就发送到网易MTA。

　　二、 MTA检查收件人服务器如果不是自己则传递到下一跳MTA，直到传递到目的MTA。

　　三、 目的MTA收到邮件后将邮件存储到MDA中，MDA对邮件进行垃圾过滤，病毒查杀。

　　四、 MRA把邮件从MDA收取到用户的收件箱中。

　　五、 MUA收取邮件，此时收取邮件只是将MRA中的邮件下载到本地。

　　重新审视整个收发过程中，其实邮件在服务器中都是明文存储，无论有多少MTA，邮件在中转过程中都相当于裸奔，这就导致了重要信息容易被截获，调查市场上的邮件安全产品大都是一套封闭邮件系统，部署上存在使用户放弃原来的账户使用新账户的问题，这就导致在部署时存在一定困难。在邮件透明加密产品中，天御云安的隐秘邮很新颖，使用安全邮件网关对邮件透明加密，用户完全感知不到邮件网关的存在，但是邮件在服务器上却穿上了盔甲，任你黑客攻破服务器，看到的邮件却是一堆乱码。
