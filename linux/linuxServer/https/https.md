CSR 在线生成工具
    https://myssl.com/csr_create.html

## 对称加密

相同的密钥加密和解密

密钥 
密文 

缺点:
    服务器之间要首先传递密钥，然后传输密文
    不同用户要不同的密钥

## 非对称加密

公钥和私钥

公钥和私钥是算法生成的

要加密的数据 + 公钥/私钥 = 密文
密文 + 私钥/公钥 = 原始数据

用户                        服务器
先请求服务器公钥
用公钥加密内容  
                            用服务器私钥解密


数据完整性

它会将报文使用一定的HASH算法算出一个固定位数的摘要信息，然后使用私钥将摘要加密，然后会将刚才的报文一起发送给接收者，接收者会通过公钥将摘要解出来。也通过hash算法算出报文摘要，如果两个摘要一致，说明数据未被篡改，说明数据是完整的。


## HTTPS 加密、解密及验证过程

      浏览器                          服务器
非 |  请求https://www.sina.com    ->  SSL证书(包含公钥，和服务器所在厂商信息, 数字签名)
对 |  
称 |  客户端解析证书 解析出公钥, 用公钥解密签名，对比自己hash的摘要信息
   |
   |  浏览器生成随机码
   |
   |  使用公钥加密这个 <随机码> 传送给服务器
   |
   |                                服务器用私钥解密获得 随机码

对 |  使用对称加密算法，使用随机码进行加密 进行传输
称
加
密


鲍勃有两把钥匙，一把是公钥，另一把是私钥

鲍勃把公钥送给他的朋友们----帕蒂、道格、苏珊----每人一把。

苏珊要给鲍勃写一封保密的信。她写完后用鲍勃的公钥加密，就可以达到保密的效果。

鲍勃收信后，用私钥解密，就看到了信件内容。这里要强调的是，只要鲍勃的私钥不泄露，这封信就是安全的，即使落在别人手里，也无法解密。

鲍勃给苏珊回信，决定采用"数字签名"。他写完后先用Hash函数，生成信件的摘要（digest）。
然后，鲍勃使用私钥，对这个摘要加密，生成"数字签名"（signature）。

鲍勃将这个签名，附在信件下面，一起发给苏珊。

苏珊收信后，取下数字签名，用鲍勃的公钥解密，得到信件的摘要。由此证明，这封信确实是鲍勃发出的。

苏珊再对信件本身使用Hash函数，将得到的结果，与上一步得到的摘要进行对比。如果两者一致，就证明这封信未被修改过。

复杂的情况出现了。道格想欺骗苏珊，他偷偷使用了苏珊的电脑，用自己的公钥换走了鲍勃的公钥。此时，苏珊实际拥有的是道格的公钥，但是还以为这是鲍勃的公钥。因此，道格就可以冒充鲍勃，用自己的私钥做成"数字签名"，写信给苏珊，让苏珊用假的鲍勃公钥进行解密。

后来，苏珊感觉不对劲，发现自己无法确定公钥是否真的属于鲍勃。她想到了一个办法，要求鲍勃去找"证书中心"（certificate authority，简称CA），为公钥做认证。证书中心用自己的私钥，对鲍勃的公钥和一些相关信息一起加密，生成"数字证书"（Digital Certificate）。

鲍勃拿到数字证书以后，就可以放心了。以后再给苏珊写信，只要在签名的同时，再附上数字证书就行了。

苏珊收信后，用CA的公钥解开数字证书，就可以拿到鲍勃真实的公钥了，然后就能证明"数字签名"是否真的是鲍勃签的。







CA: Certificate Authority
证书: CA机构，好比公安局
    “digital certificate”或“public key certificate”

证书中包含了一个密钥对（公钥和私钥）和所有者识别信息

网站的服务器会使用证书向浏览器（如 Chrome）证明该网站的身份。


**数字摘要：**通过单向hash函数对原文进行哈希，将需加密的明文“摘要”成一串固定长度(如128bit)的密文，不同的明文摘要成的密文其结果总是不相同，同样的明文其摘要必定一致，并且即使知道了摘要也不能反推出明文。

**数字签名技术：**数字签名建立在公钥加密体制基础上，是公钥加密技术的另一类应用。它把公钥加密技术和数字摘要结合起来，形成了实用的数字签名技术。
    https://blog.csdn.net/xiaoming100001/article/details/81109617



                          使用私钥将摘要加密成为签名     |          使用公钥解密得到 摘要
            Hash提取“摘要”  ----------------------->  证 |
厂商信息 ------------------------------------------>     |--->      厂商信息hash运算得到摘要    比较两个摘要是否一致
                                公钥--------------->  书 |
                                                         |






经CA认证机关颁发的电子印鉴证明就是证明两者之间的对应关系的一个电子资料，该资料指明及确认使用者名称及其公共密钥。
使用者从公开地方取得证明后，只要查验证明书内容确实是由CA机关所发，即可推断证明书内的公开密钥确实为该证明书内相对应的使用者本人所拥有。


1. 电子认证机构设立的形式。
　　
    纵观一些国家在电子认证（CA）设定的形式一般有两大类。
    第一类是直接由国家有关负责部门下属单位直接设立，从事电子认证服务工作。或者是由政府的相关部门扮演CA体系中最高一层的认证中心角色。
    第二大类是由政府相关部门做出授权，规定严格的审批条件和程序签发认证证书（Certificate），同时行使监督权，以确保网络交易的安全性。
    https://zhidao.baidu.com/question/575588654.html


CA就用于保证，你获得的公钥确实是你要访问的可靠网站的公钥，而不是别人冒充的。ca 并不能保证这个网站是真的
    比如如果你访问的就是假冒淘宝, 假冒淘宝的CA认证是真的, 也没用


### 自签名
所谓“自签名”就是把自己当成一个CA证书颁发机构，只不过未得到公共证书机构的认可。这样的CA证书在部分操作系统下，可以直接配置在应用系统里使用，在浏览器里往往会进行提示，如果加入“例外”白名单中，就可以继续使用。






密钥长度
时间有效期
CRT - CRT应该是certificate的三个字母，其实还是证书的意思，常见于*NIX系统，大多数应该是PEM编码。
CER - 还是certificate,还是证书，常见于Windows系统，大多数应该是DER编码。
CSR - Certificate Signing Request，即证书签名请求，这个并不是证书，而是向权威证书颁发机构获得签名证书的申请，其核心内容是一个公钥(当然还附带了一些别的信息)。



客户端用CA公钥解密数字签名得到服务器生成的数字摘要1。

然后客户端也同样计算md5（证书描述信息）获得一个数据摘要2。

对比数字摘要1和数字摘要2， 过关相等，则验证通过。

验证通过后，便可以取出网站公钥进行后面的操作。



DV证书只需要付款验证域名所有权即可几分钟签发，而OV或EV证书并不是只要花钱就可以签发的，因为他们需要提交真实可靠的公司单位等组织机构资料，经过人工审核通过后才可颁发，所有OV/EV证书可以增强组织机构的可信度。





OpenSSL使用PEM文件格式存储证书和密钥


生成秘钥对

openssl genrsa -out [filename] 
        -des/des3/  (算法)
        




用openssl创建CA证书的RSA 私钥(PEM格式)：
    openssl genrsa -out ca-key.pem 1024

opnessl req -new -key ca-key.pem -out ca-req.csr
    生成的csr文件交给 CA 签名后形成服务器端自己的证书


openssl x509 -req -days 365 -sha256 -in ca-req.csr -signkey ca-key.pem -out ca-cert.pem

    X.509是常见通用的证书格式。所有的证书都符合为Public Key Infrastructure (PKI) 制定的 ITU-T X509 国际标准。

    -req                  Input is a certificate request, sign and output



x509 是自签名

opnessl x509 -in cal.cer -subject -issue




## CSR:

In public key infrastructure (PKI) systems, a certificate signing request (also CSR or certification request) is a message sent from an applicant to a certificate authority in order to apply for a digital identity certificate. 

It usually contains the public key for which the certificate should be issued, identifying information (such as a domain name) and integrity protection (e.g., a digital signature). 

The most common format for CSRs is the PKCS specification and another is the Signed Public Key and Challenge SPKAC format generated by some web browsers.


是证书申请者在申请数字证书时由CSP(加密服务提供者)在生成私钥的同时也生成证书请求文件


Enter the following CSR details when prompted:

    1. Common Name: The FQDN (fully-qualified domain name) you want to secure with the certificate such as www.google.com, secure.website.org, *.domain.net, etc.
    1. Organization: The full legal name of your organization including the corporate identifier.
    1. Organization Unit (OU): Your department such as ‘Information Technology’ or ‘Website Security.’
    1. City or Locality: The locality or city where your organization is legally incorporated. Do not abbreviate.
    1. State or Province: The state or province where your organization is legally incorporated. Do not abbreviate.
    1. Country: The official two-letter country code (i.e. US, CH) where your organization is legally incorporated.


openssl req -new -SHA256 -newkey rsa:2048 -nodes -keyout helloliujiao.com.key -out helloliujiao.com.csr -subj "/C=CN/ST=HeBei/L=HanDan/O=/OU=/CN=helloliujiao.com"
                        |                |
    req                 Certificate Signing Request (CSR) Management
    -new                New request
    -SHA256             签名哈希算法
    -newkey val         Specify as type:bits    密钥算法和强度
    -nodes              Don't encrypt the output key ; 没有这个会在命令执行最后一步提示Enter PEM pass phrase
                        -----BEGIN ENCRYPTED PRIVATE KEY-----
                        -----BEGIN PRIVATE KEY-----
                        des: data encryption standard
    -keyout outfile     File to send the key to
    -out outfile        Output file
    -subj val           Set or modify request subject

    -x509               Output a x509 structure instead of a cert request
                        (Required by some CA's)



How do I decode a CSR?
    openssl req -in server.csr -noout -text
        包含申请时填写的域名等信息、公钥、签名

x509无法建立证书请求文件，所以只能使用openssl req来生成请求文件，然后使用x509来自签署。自签署时，

    使用"-req"选项明确表示输入文件为证书请求文件，否则将默认以为是证书文件，再使用"-signkey"提供自签署时使用的私钥。
        openssl req -new -keyout key.pem -out req.csr
        openssl x509 -req -in req.csr -signkey key.pem -out x509.crt

    x509也可以用来签署他人的证书请求，即为他人颁发证书。注意，为他人颁发证书时，确保serial文件存在，建议使用自动创建的选项"-CAcreateserial"。
        openssl x509 -req -in req.csr -CA ca.crt -CAkey ca.key -out x509.crt -CAcreateserial


    X.509 Certificate Data Management

### CSR什么样

CSR是以-----BEGIN CERTIFICATE REQUEST-----开头，-----END CERTIFICATE REQUEST-----为结尾的base64格式的编码。将其保存为文本文件，就是所谓的CSR文件

有CSR必定有Private KEY，是成对的，CSR最终变成为证书，和私钥key配对使用。Key是以-----BEGIN RSA PRIVATE KEY-----开头的，-----END RSA PRIVATE KEY-----结尾的

在线生成工具:
    https://myssl.com/csr_create.html
   
    https://www.cnblogs.com/xuegqcto/p/9116712.html 




### PEM

Privacy-Enhanced Mail (PEM) is a de facto file format for storing and sending cryptographic keys, certificates, and other data

 PEM also defines a one-line header, consisting of "-----BEGIN ", a label, and "-----", and a one-line footer, consisting of "-----END ", a label, and "-----". The label determines the type of message encoded. Common labels include "CERTIFICATE", "CERTIFICATE REQUEST", "PRIVATE KEY" and "X509 CRL".

PEM data is commonly stored in files with a ".pem" suffix, a ".cer" or ".crt" suffix (for certificates), or a ".key" suffix (for public or private keys).[2] The label inside a PEM file represents the type of the data more accurately than the file suffix, since many different types of data can be saved in a ".pem" file.

A PEM file may contain multiple instances. For instance, an operating system might provide a file containing a list of trusted CA certificates, or a web server might be configured with a "chain" file containing an end-entity certificate plus a list of intermediate certificates.

PEM 就是我们常用的存储公钥、私钥、证书文件的格式

https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail




### 生成私钥

https://www.jianshu.com/p/78886e480bef

openssl有多种方法生成私钥：

    genrsa生成RSA密钥。
    req在生成req证书请求时同时产生密钥。
    genpkey除了可以生成RSA密钥外，还可以生成DSA、DH密钥。

### 解析私钥

openssl asn1parse -i -in privatekey.pem

    -i               indents the output
    -noout           do not produce any output
    -in infile       input file




### DV 、OV、EV 型证书

DV和OV型证书最大的差别是：DV型证书不包含企业名称信息；而OV型证书包含企业名称信息

OV型和EV型证书，都包含了企业名称等信息，但EV证书因为其采用了更加严格的认证标准，浏览器对EV证书更加“信任”，当浏览器访问到EV证书时，可以在地址栏显示出公司名称，并将地址栏变成绿色。

EV > OV > DV

DV (Domain Validated), OV (Organization Validated) and EV (Extended Validated) 

https://www.cnblogs.com/sslwork/p/6193256.html

https://www.ssl.com/article/dv-ov-and-ev-certificates/





Certificate Authority (CA) Management.
    openssl ca
