# 对象存储（Cloud Object Storage，COS）

https://cloud.tencent.com/document/product/436/8186

非结构化数据, 图片、文档、视频

以对象的方式管理数据

存储架构

+-------------------------------------------------------------------------------------------+
|                               编程接口 (RES API)                                          |
+---------------------------------------------+---------------------------------------------+
| 数据平面(存储池)                            |                   控制平面(管理平面)        |
| 对象存储(obd)       文件存储        块存储  |                   租户，日志，部署，计量    |
+---------------------------------------------+---------------------------------------------+


对象存储基本功能

    1. 对象存储 Restful API
    2. 扁平组织形式
    3. Bucket(桶) 之间不能嵌套

对象存储在开源应用

    1. OpenStack Swift
    2. Ceph RadowsGW


Referer 防盗链
跨域访问 CORS
多地区存储
跨区域复制


灵活的软件管理
    断点续传
    自定义文件 Header
    静态网站
    生命周期管理
    消息回调

大数据及开放能力
    持久化音频处理
    PS级图片处理
    FTP 工具
    Hadoop 工具
    多种数据迁移工具


对象存储构成的逻辑关系
    Account, Bucket, Object

|                                   Root
|                                    |
|           +------------------------+----------------------------+
|           |                        |                            |
|       Account1                  Account2                    Account3          存储区域
|           |                        |                            |
|      +----+-----+            +-----+----+                 +-----+----+
|      |          |            |          |                 |          |
|   Bucket1     Bucket2     Bucket1     Bucket2          Bucket1     Bucket2    可以理解为目录或文件夹
|object object object object object object object ...



Region 物理的

    地域（Region）是腾讯云托管机房的分布地区，对象存储（Cloud Object Storage，
    COS）的数据存放在这些地域的存储桶中。您可以通过 COS，将数据进行多地域存储。
    通常情况下，COS 建议您选择在与您业务最近的地域上创建存储桶，以满足低延迟、
    低成本以及合规性要求。

    例如，当您的业务分布在华南地区，那么选择在广州地域创建存储桶可以进一步提高对象的上传、下载速度。

    <BucketName-APPID>.cos.ap-beijing.myqcloud.com

    全球加速域名的格式为<BucketName-APPID>.cos.accelerate.myqcloud.com


    内网和外网访问

    在同地域的云服务器（Cloud Virtual Machine，CVM）上，通过 COS 默认域名访问文件时，默认走内网链路，此时文件的上传和下载均产生内网流量，不会产生流量费用，但仍然有请求次数的收费。

    腾讯云 COS 的访问域名使用了智能 DNS 解析，通过互联网在不同的运营商环境下，我们会检测并指向最优链路供您访问 COS。

    如果您在腾讯云内部署了服务用于访问 COS，则同地域范围内访问将会自动被指向到内网地址。跨地域暂不支持内网访问，默认将会解析到外网地址。

Zone 一组不同的物理硬件, 不同的地区，机架

Server 运行一个或多个服务进程的物理服务器

Proxy 与外部客户端进行通信的服务

Ring 超找表


存储桶（bucket）
    是对象的载体，可理解为存放对象的“容器”。一个存储桶可容纳无数个对象。

对象（Object）
    是 COS 的基本单元，可理解为任何格式类型的数据，例如图片、文档和音视频文件等。

地域（Region）
    是腾讯云托管机房的分布地区，COS 的数据存放在这些地域的存储桶中。

访问域名（Endpoint）
    对象被存放到存储桶中，用户可通过访问域名访问和下载对象。

存储类型（StorageClass）
    指对象在 COS 中的存储级别和活跃程度。COS 提供多种存储类型：标准存储（多
    AZ）、低频存储（多 AZ）、智能分层存储（多 AZ）、智能分层存储、标准存储、低
    频存储、归档存储、深度归档存储。每种存储类型适用于不同的业务场景，拥有不同
    的特性（例如对象访问频度、访问时延等）。



                                    +---> Account
                                    |
客户端 -> Proxy Server  -> Ring --- +---> Bucket
                                    |
                                    +---> Object


## 使用方式

1. 控制台

    对象存储控制台是 COS 为用户提供的最简单且易于上手的操作方式。用户无需编写代
    码或运行程序，可直接通过 COS 控制台使用 COS 服务。

2. COSBrowser 工具

    本工具支持用户通过可视化界面，方便地进行数据的上传、下载、生成访问链接等操
    作。

3. COSCMD 工具

    本工具支持用户使用简单的命令行指令实现对对象的批量上传、下载、删除等操作。

4. API 方式

    COS 使用 XML API，这是一种轻量级的、无连接状态的接口，调用此接口您可以直接
    通过 HTTP/HTTPS 发出请求和接受响应，实现与腾讯云对象存储后台的交互操作。

5. SDK 方式

    支持多种主流开发语言：Android、C、C++、.NET、Go、iOS、Java、JavaScript、
    Node.js、PHP、Python、小程序 SDK。

## 域名

自定义 CDN 加速域名

    用户可以为存储桶，绑定已备案的自定义域名至腾讯云国内 CDN 加速平台，通过自定
    义域名访问存储桶中的对象。详情请参见 域名管理概述。

自定义源站域名

    用户可以将已备案的自定义域名，绑定至当前存储桶，通过自定义域名访问存储桶内对象。

默认 CDN 加速域名

    经由 CDN 加速节点加速的域名，系统默认生成，用户可选择开启或关闭。

默认域名

    即对象存储源站域名，是创建存储桶时，由系统根据存储桶名称和地域自动生成的，要与默认加速域名区分开。

数据取回

    低频存储和归档存储类型为冷数据存储类型。

    对于低频数据来说，当您读取或下载该数据时，后台需要先取回数据后才可以读取或
    下载。

    对于归档数据来说，不可读取和下载，此时数据取回也可以称之为数据解冻（即把归
    档数据恢复至标准数据这一过程）。

## 费用

外网下行流量

    指数据通过互联网从对象存储传输到客户端产生的流量，包括用户直接通过对象链接
    下载对象或通过静态网站源站浏览对象产生的流量。

CDN 回源流量

    指数据从对象存储传输到腾讯云内容分发网络（Content Delivery Network，CDN）边
    缘节点产生的流量。

当您将文件上传至存储桶后，对象存储（Cloud Object Storage，COS）会自动生成文件链
接（文件的 URL），您可以直接通过文件 URL（即 COS 默认域名）访问该文件。

若您希望通过 CDN 或自己的域名访问 COS 上的文件，需要将 CDN 域名或自己的域名绑定
至文件所在的存储桶。

您可以根据实际需求，使用对应的域名访问文件。例如您想通过 CDN 加速访问文件，则需
要访问由 CDN 加速域名生成的文件链接。


记录类型选择 CNAME，线路类型选择默认，记录值请填写您的存储桶域名，TTL 保持默认。信息填写完毕后，单击保存即可



## COS 存储级别

1. 标准存储
    高可靠
    高可用
    高性能

    热点数据

2. 低频存储
    高可靠
    较低存储成本
    较低访问延时


    30天的最低存储时间

3. 近线存储
    高可靠
    较低访问延时
    极低存储成本

    60天的最低存储时间



API
SDK
控制台

## 网盘应用

## 数据灾备

热数据 温数据 冷数据


## bucket

存放文件的容器

一个用户可以有多个 bucket

每个 object 都存储在一个特定的 bucket 中

## object

每一个文件就是一个 object

由 metadata 和 data 组成


## appid

用于区分不同的项目

类似 cpp 中的 namespace


## 使用

云产品 / 存储与CDN / 对象存储COS / 立即使用

1. 创建 bucket
    
    一类资源的集合

    存储桶是对象的容器，可存放任何格式类型的数据。您可通过控制台、API、SDK等多种方式操作。

    立刻创建 bucket, 
        所属项目
        Bucket 名称
        访问权限
        CDN加速
    
    生成的域名： bucketname-1256847772.cos.ap-hongkong.myqcloud.com
        bucketname 
        Appid: 1256847772

    私有文件权限：后边的是签名

## CDN 加速域名

加速域名添加成功后，会进入审核流程。当您的加速域名审核通过后，阿里云CDN会为您分
配对应的CNAME地址。您需要将加速域名指向CNAME地址，访问加速域名的请求才能转发到
CDN节点上，达到加速效果。 

## 常见问题

1. DDoS

    配置 bucket 防盗链功能，黑/白名单自由管控，有效防止 DDOS 攻击产生的流量费用

2. secret id, secret key

    登录控制台，左侧密钥管理
    1. 新增一对新的有效密钥
    2. 将业务系统中旧密钥替换为新的
    3. 禁用疑似已泄露的旧密钥

    可以无缝切换密钥

3. SDK

    https://cloud.tencent.com/document/product/436/6474

    appid
    secret_id
    secret_key
    endpoint 是 COS 访问域名信息，可以通过腾讯云【COS 可用地域】 页面查看。 例如，广州地区 endpoint 为 cos.ap-guangzhou.myqcloud.com。


自2022年5月9日起，对象存储（Cloud Object Storage，COS）服务将不再支持新增默认
CDN 加速域名.建议您使用自定义 CDN 加速域名代替默认 CDN 加速域名。


