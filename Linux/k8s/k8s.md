

资源管理

## 前世今生

Apache MESOS

Docker SWARM

    功能较少

    很小，几十兆

kubernetes

    Logo:方向舵

    Kubernetes的架构设计基本上是参照了Google Borg，谷歌16年容器使用经验，borg 容器管理平台，使用 golang 重构 borg

    特点：

        轻量级: 消耗资源小
        
        开源

        弹性伸缩

        负载均衡: ipvs


## 知识图谱


## 组件说明

### borg

        ```

        +-----------+       +-----------+
        |  kubectl  |       |  web UI   |
        +-----------+       +-----------+
            |                   |
            |                   |
    +---------------------------------------+
    |                                       |
    |   +-------------+         +---------+ |
    |   | scheduler   |----->---|         | |       
    |   +-------------+         |         | |       +------+
    |                           | API     | |------>| etcd |
    |   +-------------+         | Server  | |       +------+
    |   | replication |----->---|         | |       
    |   | controller  |         |         | |
    |   +-------------+         +---------+ |
    |                                |      |
    +--------------------------------|------+
                                     |
    node    +----------------------------------+
            |  kubelet          kube proxy     |
    node    | +------------+   +-------------+ |
            | | Pod        |   | Pod         | |     firewall
            | | +---------+|   | +---------+ | |
            | | |container||   | |container| | |
            | | +---------+|   | +---------+ | |
            | +------------+   +-------------+ |
            +----------------------------------+
        ```



etcd: 可信赖的分布式键值存储服务，它能够为整个分布式集群存储一些关键数据，协助分布式集群的正常运转

    天生支持集群化

    V2版 放到 Memory

    V3版 放到 Database

    推荐在 Kubernetes 集群中使用 Etcd v3, v2 版本在 Kubernetes v1.11 中弃用


kubelet: 

kube proxy:

API Server: 所有服务的访问统一入口

Controller Manager: 维持副本期望数目

Scheduler: 负责接收任务，选择合适的节点进行任务分配

etcd: 键值对数据库， 存储 K8s 集群所有重要信息(持久化)

Kubelet: 直接跟容器引擎交互实现容器的生命周期管理

Kube-porxy: 负责写入规则至 Iptables、IPVS 实现服务映射访问


CoreDNS: 可以为集群中的 SVC 创建一个域名IP的对应关系解析

Dashboard: 给 K8S 集群提供的一个 B/S 结构访问体系

Ingress Controller: 官方只能实现四层代理，Ingress 可以实现七层管理

Federtation: 提供一个可以跨集群中心多K8S同意管理功能

Prometheus:

ELK:


### ETCD

                +--------------------+    
                |        ETCD        |
                +--------------------+    

    +----------------------------------------------+
    |                   HTTP Server                |
    +----------------------------------------------+
        |                               |
        |                               |
    +---------+ -------<-->---- +------------------+
    |   Raft  |                 |                  |
    +---------+--<->----+       |                  |
        |               |       |                  |
    +---------------+   |       |                  |
    |   |  WAL      |   |       |                  |
    | +---------+   |   |       |     Store        |
    | |  Entry  |   |   |       |                  |
    | +---------+   |   |       |                  |
    | +---------+   |   |       |                  |
    | | Snapshot|--------       |                  |
    | +---------+   |           |                  |
    +---------------+           +------------------+





### Pod 


分类

    1. 自主式 Pod(不是被控制器管理的 Pod )

    1. 控制器管理的 Pod


一个Pod 会先启动第一个容器(pause)

Pod 可以有多个容器，这些容器共享 网络栈(pause的)，可以通过 localhost 的不同端口相互访问，

pod 中的容器仅网络不隔离, 端口不能冲突

    共享存储卷



Deployment

ReplicaSet

Horizontal Pod Autoscaling  水平Pod自动扩展


StatefulSet
    
    1. 稳定的持久化存储

    1. 稳定的网络标志

    1. 有序部署，有序扩展

    1. 有序收缩，有序删除


DaemonSet


Job: 负责批处理任务，即仅执行一次的任务，它保证批处理任务的一个或多个 Pod 成功结束


服务发现






### 网络通讯方式
