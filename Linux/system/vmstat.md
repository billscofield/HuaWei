

vmstat(Virtual Memory Statistics 虚拟内存统计)

命令用来显示Linux系统虚拟内存状态，也可以报告关于进程、内存、I/O等系统整体运行状态。

vmstat命令是最常见的Linux/Unix监控工具，可以展现给定时间间隔的服务器的状态值, 包括服务器
的CPU使用率，内存使用，虚拟内存交换情况,IO读写情况。这个命令是我查看Linux/Unix最喜爱的命
令，一个是Linux/Unix都支持，二是相比top，我可以看到整个机器的CPU,内存,IO的使用情况，而不
是单单看到各个进程的CPU使用率和内存使用率(使用场景不一样)。

一般 vmstat 工具的使用是通过两个数字参数来完成的，第一个参数是采样的时间间隔数，单位是秒，第二个参数是采样的次数

SYNOPSIS

    vmstat [options] [delay [count]]


procs -----------memory----------   ---swap--   -----io---- -system--  ------cpu------
r  b   swpd   free    inact  active   si   so    bi    bo    in   cs    us sy id wa st
0  0      0   6172020 468280 1288872   0    0     1   289    68   27     1  1 95  3  0



vmstat命令, 输出歪歪扭扭的, 强迫症简直不能忍啊

    vmstat | column -t


-t --timestamp


vmstat支持列模式, -s可以按照列输出, -Sm修改输出的单位为m

-S, --unit character
    -SM
    -Sm
    Switches  outputs  between  1000  (k),  1024  (K),  1000000 (m), or 1048576 (M) bytes.  Note this does not change the swap
    (si/so) or block (bi/bo) fields.

    应该用大的 -K(默认) -M


```
|    8170480 K total memory
|     466564 K used memory
|    1288932 K active memory
|     468300 K inactive memory
|    6172020 K free memory
|     640800 K buffer memory
|     891096 K swap cache
|     998396 K total swap
|          0 K used swap
|     998396 K free swap
|     406248 non-nice user cpu ticks
|       1279 nice user cpu ticks
|     459152 system cpu ticks
|   41566027 idle cpu ticks
|    1282604 IO-wait cpu ticks
|          0 IRQ cpu ticks
|      26910 softirq cpu ticks
|          0 stolen cpu ticks
|     549627 pages paged in
|  126499880 pages paged out
|          0 pages swapped in
|          0 pages swapped out
|  201809403 interrupts
|  183588895 CPU context switches
| 1614155152 boot time
|    1176183 forks

```

mysql也有对应的列模式:

    select *  from hotel_order_simple limit 1 \G;



+------------------+--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|      类别        | 项目   |    含义                                                      | 说明                                                                           |
+------------------+--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|Procs（进程）     | r      |    等待执行的任务数                                          | 展示了正在执行和等待cpu资源的任务个数。当这个值超过了cpu个数，就会出现cpu瓶颈。|
|                  | B      |    等待IO的进程数量                                          |                                                                                |
+------------------+--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|                  |        |                                                              |                                                                                |
|Memory(内存)      | swpd   |    正在使用虚拟的内存大小，单位k                             |                                                                                |
|                  | free   |    空闲内存大小                                              |                                                                                |
|                  | buff   |    已用的buff大小，对块设备的读写进行缓冲                    |                                                                                |
|                  | cache  |    已用的cache大小，文件系统的cache                          |                                                                                |
|                  | inact  |    非活跃内存大小，即被标明可回收的内存，区别于free和active  | 具体含义见：概念补充（当使用-a选项时显示）                                     |
|                  | active |    活跃的内存大小                                            | 具体含义见：概念补充（当使用-a选项时显示）                                     |
+------------------+-----------------------------------------------------------------------+--------------------------------------------------------------------------------+
|                  |        |                                                              |                                                                                |
|Swap              | si     |    每秒从交换区写入内存的大小（单位：kb/s）                  |                                                                                |
|                  | so     |    每秒从内存写到交换区的大小                                |                                                                                |
+------------------+--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|                  |        |                                                              |                                                                                |
|IO                |        |                                                              |                                                                                |
|                  |        |                                                              |                                                                                |
|                  | bi     |    每秒读取的块数（读磁盘）                                  | 块设备每秒接收的块数量，单位是block，                                          |
|                  |        |                                                              | 这里的块设备是指系统上所有的磁盘和其                                           |
|                  |        |                                                              | 他块设备，现在的Linux版本块的大小为1024bytes                                   |
|                  +--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|                  | bo     |    每秒写入的块数（写磁盘）                                  | 块设备每秒发送的块数量，单位是block                                            |
+------------------+--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|system            |        |                                                              |                                                                                |
|                  |        |                                                              |                                                                                |
|                  | in     |    每秒中断数，包括时钟中断                                  | 这两个值越大，会看到由内核消耗的cpu时间sy会越多                                |
|                  +--------+-----------------------------                                 | 秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，                   |
|                  | cs     |    每秒上下文切换数                                          | 线程的切换，也要进程上下文切换，这个值要越小越好，太大了，                     |
|                  |        |                                                              | 要考虑调低线程或者进程的数目                                                   |
+------------------+--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|CPU(以百分比表示) |        |                                                              |                                                                                |
|                  |        |                                                              |                                                                                |
|                  | us     |    用户进程执行消耗cpu时间(user time)                        | us的值比较高时，说明用户进程消耗的cpu时间多，但是如果长期超过50%的使用，       |
|                  |        |                                                              | 那么我们就该考虑优化程序算法或其他措施了                                       |
|                  +--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|                  | sy     |    系统进程消耗cpu时间(system time)                          | sys的值过高时，说明系统内核消耗的cpu资源多，这个不是良性的表现，我们应         |
|                  |        |                                                              | 该检查原因。这里us + sy的参考值为80%，如果us+sy 大于 80%说明可能存在CPU不足    |
|                  +--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|                  | Id     |    空闲时间(包括IO等待时间)                                  | 一般来说 us+sy+id=100                                                          |
|                  +--------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
|                  | wa     |    等待IO时间                                                | wa过高时，说明io等待比较严重，这可能是由于磁盘大量随机访问造成的，             |
|                  |        |                                                              | 也有可能是磁盘的带宽出现瓶颈。                                                 |
|+-----------------+ -------+--------------------------------------------------------------+--------------------------------------------------------------------------------+
